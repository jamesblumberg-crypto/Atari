mads 2.1.7
Source: macros.asm
     1 				.macro inc16 addr
     2 				    inc :addr
     3 				    bne skip_carry
     4 				    inc :addr + 1
     5 				skip_carry
     6 				.endm
     7
     8 				.macro dec16 addr
     9 				    lda :addr
    10 				    bne skip_borrow
    11 				    dec :addr + 1
    12 				skip_borrow
    13 				    dec :addr
    14 				.endm
    15
    16 				.macro adbw src val
    17 				    lda :src
    18 				    add :val
    19 				    sta :src
    20 				    bcc skip_carry
    21 				    inc :src + 1
    22 				skip_carry
    23 				.endm
    24
    25 				.macro advance_ptr data ptr width count offset
    26 				    mwa :data :ptr
    27 				    lda :count  ; Check to make sure it's not 0
    28 				    beq done    ; If it is, we're done
    29 				
    30 				    ldy #0
    31 				loop
    32 				    adbw :ptr :width
    33 				    iny
    34 				    cpy :count
    35 				    bne loop
    36 				
    37 				done
    38 				    adbw :ptr :offset
    39 				.endm
    40
    41 				.macro copy_bytes src dest num_bytes
    42 				    mwa #:src tmp_addr1
    43 				    mwa #:dest tmp_addr2
    44 				
    45 				    ldy #0
    46 				loop
    47 				    lda (tmp_addr1),y
    48 				    sta (tmp_addr2),y
    49 				    iny
    50 				    cpy #:num_bytes
    51 				    bne loop
    52 				
    53 				.endm
    54
    55 				.macro copy_data src dest num_pages
    56 				    mwa #:src tmp_addr1
    57 				    mwa #:dest tmp_addr2
    58 				
    59 				    ldy #0
    60 				    ldx #0
    61 				loop
    62 				    lda (tmp_addr1),y
    63 				    sta (tmp_addr2),y
    64 				    iny
    65 				    bne loop
    66 				    inc tmp_addr1 + 1
    67 				    inc tmp_addr2 + 1
    68 				    inx
    69 				    cpx #:num_pages
    70 				    bne loop
    71 				.endm
    72
    73 				.macro copy_monster_colors src dest start
    74 				    mwa #:src tmp_addr1
    75 				
    76 				    lda :start
    77 				    asl
    78 				    add :start
    79 				    tay
    80 				
    81 				    lda (tmp_addr1),y
    82 				    sta :dest + 11
    83 				    iny
    84 				    lda (tmp_addr1),y
    85 				    sta :dest + 12
    86 				    iny
    87 				    lda (tmp_addr1),y
    88 				    sta :dest + 13
    89 				.endm
    90
    91
    92 				.macro copy_monsters src dest start
    93 				    ; Characters are 8 bytes wide
    94 				    ; Tiles are 2 chacters wide
    95 				    ; In the dungeon/outdoor charset, there's an open section starting at character 88
    96 				    mwa #:src tmp_addr1
    97 				    mwa #:dest tmp_addr2
    98 				
    99 				    adw tmp_addr2 #(88 * 8)
   100 				
   101 				    lda :start
   102 				    cmp #16
   103 				    bne shift
   104 				    adw tmp_addr1 #256
   105 				    jmp done
   106 				shift
   107 				    asl
   108 				    asl
   109 				    asl
   110 				    asl
   111 				    sta tmp
   112 				    adbw tmp_addr1 tmp
   113 				
   114 				done
   115 				    ldy #0
   116 				loop
   117 				    lda (tmp_addr1),y
   118 				    sta (tmp_addr2),y
   119 				    iny
   120 				
   121 				    cpy #192
   122 				    bne loop
   123 				
   124 				.endm
